<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=windows-1251"/>
	<title>nog_gscope</title>
	<meta name="generator" content="LibreOffice 6.1.0.3 (Windows)"/>
	<meta name="created" content="00:00:00"/>
	<meta name="changed" content="2020-09-18T10:25:37.164000000"/>
	<meta name="" content=""/>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
	<!-- Custom stylesheet, it must be in the same directory as the html file -->
	<!-- Loading mathjax macro -->
	<!-- Load mathjax -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_HTML"></script>
	<!-- MathJax configuration -->
	<script>
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true,
            processEnvironments: true
        },
        // Center justify equations in code and markdown cells. Elsewhere
        // we use CSS to left justify single line equations in code cells.
        displayAlign: 'center',
        "HTML-CSS": {
            styles: {'.MathJax_Display': {"margin": 0}},
            linebreaks: { automatic: true }
        }
    });
    

</script>
	<!-- End of mathjax configuration -->
	<style type="text/css">
		p { margin-bottom: 0.24cm; color: #000000; font-family: "Helvetica Neue", "Helvetica", "Arial", sans-serif; font-size: 9pt; line-height: 142% }
		pre { color: #000000; font-family: monospace, monospace; line-height: 142% }
		a:link { color: #337ab7; background: transparent; text-decoration: none }
		a:visited { color: #337ab7; background: transparent; text-decoration: none }
	</style>
</head>
<body lang="ru-RU" text="#000000" link="#337ab7" vlink="#337ab7" bgcolor="#ffffff" dir="ltr" style="border: none; padding: 0cm">
<div id="notebook" dir="ltr"><p><br/>
<br/>

	</p>
	<div id="notebook-container" dir="ltr"><p><br/>
<br/>

		</p>
		<pre style="margin-bottom: 0.5cm">import pandas as pd</pre><p>
		<br/>
<br/>

		</p>
		<pre style="margin-bottom: 0.5cm">df = pd.read_csv(r'D:\data_science\проекты\спец.конс.ст\ngo_country_all.csv', header=0)</pre><p>
		<br/>
<br/>

		</p>
		<pre style="margin-bottom: 0.5cm">df['Funding_Funds from other Non-Governmental Organizations'].value_counts()</pre><p>
		Out[4]:</p>
		<pre>0    3142
1     399
Name: Funding_Funds from other Non-Governmental Organizations, dtype: int64</pre><p>
		In&nbsp;[5]:</p>
		<pre style="margin-bottom: 0.5cm">lang = df.loc[df['Languages'].str.contains('Russian')]</pre><p>
		In&nbsp;[6]:</p>
		<pre style="margin-bottom: 0.5cm">df['GScope'].value_counts()</pre><p>
		Out[6]:</p>
		<pre>International    1819
National          999
Local             319
Regional          288
unknown           116
Name: GScope, dtype: int64</pre><p>
		In&nbsp;[7]:</p>
		<pre>for index, row in df.iterrows():
    if 'Regional' in row['GScope']:
        df.at[index, 'GScope'] = 'Regional'</pre><p>
		In&nbsp;[8]:</p>
		<pre style="margin-bottom: 0.5cm">df['GScope'] = df['GScope'].fillna('unknown')</pre><p>
		In&nbsp;[9]:</p>
		<pre style="margin-bottom: 0.5cm">df.to_csv(r'D:\data_science\проекты\спец.конс.ст\ngo_all.csv')</pre><p>
		In&nbsp;[10]:</p>
		<pre style="margin-bottom: 0.5cm">df = pd.read_csv(r'D:\data_science\проекты\спец.конс.ст\ngo_all.csv', header=0)</pre><p>
		In&nbsp;[11]:</p>
		<pre style="margin-bottom: 0.5cm">df.info()
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 3541 entries, 0 to 3540
Columns: 410 entries, Unnamed: 0 to Funding_Funds from other Non-Governmental Organizations
dtypes: float64(2), int64(398), object(10)
memory usage: 11.1+ MB</pre><p>
		In&nbsp;[12]:</p>
		<pre style="margin-bottom: 0.5cm">countries = pd.read_excel(r'D:\data_science\проекты\спец.конс.ст\countries.xlsx', header=None)</pre><p>
		In&nbsp;[13]:</p>
		<pre style="margin-bottom: 0.5cm">countries.info()
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 255 entries, 0 to 254
Data columns (total 1 columns):
0    255 non-null object
dtypes: object(1)
memory usage: 2.1+ KB</pre><p>
		In&nbsp;[14]:</p>
		<pre>country = []
for index, row in countries.iterrows():
    country.append(row[0])</pre><p>
		In&nbsp;[15]:</p>
		<pre style="margin-bottom: 0.5cm">len(country)</pre><p>
		Out[15]:</p>
		<pre style="margin-bottom: 0.5cm">255</pre><p>
		In&nbsp;[16]:</p>
		<pre>for c in country:
    for index, row in df.iterrows():
        if c in row['AreaOfActivity']:
            df['AreaOfActivity_{}'.format(c)] = 0
---------------------------------------------------------------------------
KeyboardInterrupt                         Traceback (most recent call last)
&lt;ipython-input-16-22bca07c380b&gt; in &lt;module&gt;
      1 for c in country:
----&gt; 2     for index, row in df.iterrows():
      3         if c in row['AreaOfActivity']:
      4             df['AreaOfActivity_{}'.format(c)] = 0

c:\users\елена\appdata\local\programs\python\python37\lib\site-packages\pandas\core\frame.py in iterrows(self)
    892         klass = self._constructor_sliced
    893         for k, v in zip(self.index, self.values):
--&gt; 894             s = klass(v, index=columns, name=k)
    895             yield k, s
    896 

c:\users\елена\appdata\local\programs\python\python37\lib\site-packages\pandas\core\series.py in __init__(self, data, index, dtype, name, copy, fastpath)
    309                     data = data.copy()
    310             else:
--&gt; 311                 data = sanitize_array(data, index, dtype, copy, raise_cast_failure=True)
    312 
    313                 data = SingleBlockManager(data, index, fastpath=True)

c:\users\елена\appdata\local\programs\python\python37\lib\site-packages\pandas\core\internals\construction.py in sanitize_array(data, index, dtype, copy, raise_cast_failure)
    747         and not is_object_dtype(dtype)
    748     ):
--&gt; 749         inferred = lib.infer_dtype(subarr, skipna=False)
    750         if inferred == &quot;period&quot;:
    751             try:

pandas\_libs\lib.pyx in pandas._libs.lib.infer_dtype()

pandas\_libs\lib.pyx in pandas._libs.lib._try_infer_map()

c:\users\елена\appdata\local\programs\python\python37\lib\site-packages\numpy\core\_dtype.py in _name_get(dtype)
    317 
    318 
--&gt; 319 def _name_get(dtype):
    320     # provides dtype.name.__get__
    321 

KeyboardInterrupt: </pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">df['AreaOfActivity'] = df['AreaOfActivity'].fillna('unknown')</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre>for c in country:
    for index, row in df.iterrows():
        if c in row['AreaOfActivity']:
            df.at[index, 'AreaOfActivity_{}'.format(c)] = 1</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">print(df.columns[-182:])</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre>AreaOfActivity_dict = {}
for a in df.columns[-182:]:
    count = df['{}'.format(a)].value_counts()
    AreaOfActivity_dict[a] = count[1]</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">AreaOfActivity = pd.Series(AreaOfActivity_dict)</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">AreaOfActivity.sort_values()</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">df[['Established', 'Registered']].head()</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">df['Funding'] = df['Funding'].fillna('unknown')</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">Funding_set = set()</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">import re</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">pattern = '[A-Z]'</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">test = df.iloc[0:10, :]</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre>matches = []
for index, row in df.iterrows():
    match = re.findall(r&quot;[A-Z][^A-Z]*&quot;, row['Funding'])
    matches.append(match)</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">matches_set = set()</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre>for index, item in enumerate(matches):
    for index1, item1 in enumerate(item):
        matches_set.add(item1)</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">matches_set</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">Funding = ['Donations and grants from domestic sources', 'Fees for education and training services', 'Fees for providing consulting or research services', 'Foreign and international grants', 'Fundraising campaigns', 'Grants from Governments', 'Funds from other Non-Governmental Organizations', 'Funds from Religious Institutions', 'Membership fees or dues', 'Other sources', 'Product sales and business services']</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">len(Funding)</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre>for f in Funding:
    df['Funding_{}'.format(f)] = 0</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre>for f in Funding:
    for index, row in df.iterrows():
        if f in row['Funding']:
            df.at[index, 'Funding_{}'.format(f)] = 1</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">df = df.drop('Funding_Funds from Non-Governmental Organizations', axis=1)</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">df.columns[-11:]</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre>count_fund = {}
for f in df.columns[-11:]:
    count = df['{}'.format(f)].value_counts()
    count_fund[f] = count[1]</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">count_fund</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">fund.sort_values()</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre>fund = pd.Series(count_fund)
fund.plot(kind='bar')</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">df[['Registered', 'Established']].head()</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">df = df.drop(['Structure', 'Members'], axis=1)</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">df.columns</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">df.head()</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">df = df.drop(['Unnamed: 0', 'Unnamed: 0.1', 'Unnamed: 0.1.1', 'City', '(E)'], axis=1)</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">patterns = ['Economic and Social', 'Public Administration', 'Population', 'Conflict Resolution in Africa', 'Sustainable Development', 'Financing for Development', 'Statistics', 'Social Development', 'Gender Issues and Advancement of Women', 'Peace and Development in Africa', 'NEPAD']</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">import numpy as np</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">df['Expertise'] = df['Expertise'].replace(np.nan, 'unknown')</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre>for e in patterns:
    df['{}'.format(e)] = 0</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">errors = {}</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre>for index, row in df.iterrows():
    s = row['Expertise'].strip()
    while len(s)&gt;0:
        p = s.find(':')
        s1 = s[:p]
        if s1 in df.columns:
            for ind, item in enumerate(df.columns):
                if s1 == item:
                    s2 = s[p+1:]
                    p2 = s2.find(':')
                    if p2 == -1:
                        df.iloc[index, ind] = s2
                        s = ''
                    else:
                        s3 = s2[:p2]
                        is_found = False
                        for ind2, item2 in enumerate(df.columns):
                            if s3.endswith(item2):
                                s4 = s3[:-len(item2)]
                                df.iloc[index, ind2] = s4
                                s = s2[p2-len(item2):]
                                is_found = True
                                break
                        if not is_found:
                            errors[index] = s3
                            s = ''
        else:
            errors[index] = s1
            s = ''</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">df.columns[-25:]</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre>df = df.drop(['Expertise_Economic and Social', 'Expertise_Public Administration',
       'Expertise_Population', 'Expertise_Conflict Resolution in Africa',
       'Expertise_Sustainable Development',
       'Expertise_Financing for Development', 'Expertise_Statistics',
       'Expertise_Social Development',
       'Expertise_Gender Issues and Advancement of Women',
       'Expertise_Peace and Development in Africa', 'Expertise_NEPAD'], axis=1)</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">errors</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">df.info()</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">df.columns[406:]</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">df = df.drop('Unnamed: 0', axis=1)</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">df['Statistics'].value_counts()</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">matches = []</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">df['Economic and Social'] = df['Economic and Social'].replace('unknown', '')</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre>for index, row in df.iterrows():
    match = re.findall(r&quot;[A-Z][^A-Z]*&quot;, row['Economic and Social'])
    matches.append(match)</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">matches</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">matches_set = set()</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre>for index, item in enumerate(matches):
    for index1, item1 in enumerate(item):
        matches_set.add(item1)</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">matches_list = list(matches_set)</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre>for index, item in enumerate(matches_list):
    matches_list[index] = item.strip()</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">matches_new = set(matches_list)</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">from sklearn.feature_extraction.text import CountVectorizer</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">exp = df.columns[406:]</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">df[exp].head()</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">df['Economic and Social'] = df['Economic and Social'].replace('', 0)</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre>for c in patterns:
    df['Expertise_{}'.format(c)] = 0</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre>for index, row in df.iterrows():
    for c in patterns:
        if c in row['Expertise']:
            df.at[index, 'Expertise_{}'.format(c)] = 1</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">df.columns[417:]</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">exp_count = {}</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre>for e in df.columns[417:]:
    count = df['{}'.format(e)].value_counts()
    exp_count[e] = count[1]</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">exp = pd.Series(exp_count)</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">exp.plot(kind='bar')</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">df.info()</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">df = df.drop('Unnamed: 0', axis=1)</pre><p>
		In&nbsp;[&nbsp;]:</p>
		<pre style="margin-bottom: 0.5cm">df.head()</pre>
	</div>
</div>
</body>
</html>